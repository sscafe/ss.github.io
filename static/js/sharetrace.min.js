!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ShareTrace=t():e.ShareTrace=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1);t.default={init:r.c,wakeUp:r.f,download:r.a,ulinkOrSchemeWakeUp:r.e,downloadOnly:r.b,preDownload:r.d}},function(e,t,n){"use strict";t.c=function(e){var t,n,o;"string"==typeof e?c=e:"object"==typeof e&&(c=e.appkey,Object.prototype.hasOwnProperty.call(e,"param")&&(u=e.param),t=e.success,n=e.error,o=e.channel,Object.prototype.hasOwnProperty.call(e,"serverDomain")&&(b=e.serverDomain),Object.prototype.hasOwnProperty.call(e,"waitTime")&&(x=e.waitTime));let p=localStorage.getItem("ST-Bid");p||(p=S(32),m=p,localStorage.setItem("ST-Bid",m));var m;!function(e){var t=!1;try{if(v)return t=!0,void e();var n=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(n){var r=new n({iceServers:[]});r.createDataChannel("sharetrace",{reliable:!1}),r.onicecandidate=function(n){if(n&&n.candidate){var r=n.candidate.candidate;t=!0,e(r.split(" ")[4])}},r.createOffer(function(e){r.setLocalDescription(e)},function(e){})}}catch(e){}setTimeout(function(){!t&&e&&e()},150)}(function(e){var m=function(){var e=document.createElement("canvas");if(e&&"function"==typeof e.getContext)for(var t=["webgl","webgl2","experimental-webgl2","experimental-webgl"],n=0;n<t.length;n++){var r=t[n],o=e.getContext(r);if(o){var i={};i.context=r,i.version=o.getParameter(o.VERSION),i.vendor=o.getParameter(o.VENDOR),i.sl_version=o.getParameter(o.SHADING_LANGUAGE_VERSION),i.max_texture_size=o.getParameter(o.MAX_TEXTURE_SIZE);var a=o.getExtension("WEBGL_debug_renderer_info");return a&&(i.vendor=o.getParameter(a.UNMASKED_VENDOR_WEBGL),i.renderer=o.getParameter(a.UNMASKED_RENDERER_WEBGL)),i}}return{}}(),v=u;if(void 0===v){var h=window.location.href.split("?");h.length>1&&(v=h[1])}void 0===v&&(v="");var w=new XMLHttpRequest;w.onreadystatechange=function(){if(w.readyState===XMLHttpRequest.DONE){l=!1;var e=JSON.parse(w.responseText),r=e.data||{};i=r.download_url,a=r.trace_id,s=r.scheme,d=r.ulink,E=r.w_type,g=r.cp_html,y=x||r.lw,O=r.cwu,f=!0,200!==e.status&&e.error?n?n(e.error):alert(e.error):t&&t()}},w.open("POST",A(c)+"/api/trace/web/init/v7/"+c,!0),w.setRequestHeader("Content-type","application/json"),l||f||(l=!0,w.send(JSON.stringify({sw:window.screen.width,sh:window.screen.height,ss:window.devicePixelRatio,glr:m.renderer,glv:m.vendor,li:e,pr:v,bid:p,ch:o,v:r})))})},t.f=function(e=!1){if(!s)return;(m||v&&e)&&(N(1,0,i,s,""),T=!0)},t.e=function(){if(!s&&!d)return;N(1,0,i,s,d)},t.a=function(){if(!i)return;this.preDownload(),N(1,1,i,s,d)},t.b=function(){if(!i)return;this.preDownload(),N(0,1,i,"","")},t.d=function(e){if(!a)return;var t=function(e){const t=function(e){const t="rtl"===document.documentElement.getAttribute("dir"),n=document.createElement("textarea");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[t?"right":"left"]="-9999px";let r=window.pageYOffset||document.documentElement.scrollTop;return n.style.top=`${r}px`,n.setAttribute("readonly",""),n.value=e,n}(e);document.body.appendChild(t),function(e){let t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){let n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();let n=window.getSelection(),r=document.createRange();r.selectNodeContents(e),n.removeAllRanges(),n.addRange(r),t=n.toString()}}(t),g&&function(e){let t=function(n){n.clipboardData&&(n.clipboardData.setData("text/plain"," "),n.clipboardData.setData("text/html",'<a id="'+e+'"> </a>'),n.preventDefault(),document.removeEventListener("copy",t))};document.addEventListener("copy",t)}(e);let n=!1;try{n=document.execCommand("copy")}catch(e){}return t.remove(),n}((d=c,u=a,l=S(5),f=S(3),p=l+d.substring(0,5)+f+d.substring(5),m=f+u.substring(0,10)+l+u.substring(10),"SHARETRACE:"+p+":"+m)),n=e||function(e){if(!e)return!0;return e.indexOf(".apk")>=0||e.indexOf(".plist")>=0||e.indexOf("itms-services:")>=0||e.indexOf("market:")>=0||e.indexOf("/api/file/download/")>=0||e.indexOf("/dc/apk/")>=0}(i),r=new XMLHttpRequest,s=!1;var d,u,l,f,p,m;n?(r.timeout=3e3,r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(!s&&e&&(s=!0,e()),function(){if(!window.Worker)return;o&&o.terminate();e=new Blob(['(function fw(){var startWorkerTs;var isIos;var timeout=2000;var duration;var mrip=function(inthost,params,cb){var xhr=new XMLHttpRequest();xhr.timeout=3000;xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE){var resObj=JSON.parse(xhr.responseText);var resData=resObj["data"];cb&&cb(resData)}};xhr.onerror=function(){cb&&cb(true)};xhr.open("POST",inthost+"/api/trace/web/mt/"+params,true);xhr.send()};var start=function(data){isIos=data.t;timeout=isIos?3000:2000;duration=isIos?3*60*1000:25*60*1000;var f=function(){mrip(data.h,data.p,function(res){if(res&&new Date().getTime()-startWorkerTs<duration){if(!isIos){timeout=timeout+3000}setTimeout(f,timeout)}else{self.close()}})};setTimeout(f,timeout);startWorkerTs=new Date().getTime()};self.onmessage=function(e){var data=e.data;switch(data.cmd){case"st":start(data.d);break}}})()']),t=window.URL.createObjectURL(e),o=new Worker(t);var e,t;var n={trace_id:a,appkey:c},r=function(e){var t=window.btoa(e),n=t.length;n>3&&(n=function(e,t){switch(arguments.length){case 1:return parseInt(Math.random()*e+1,10);case 2:return parseInt(Math.random()*(t-e+1)+e,10);default:return 0}}(3,9));var r=S(3),o=t.substring(0,n),i=t.substring(n,t.length);return n+o+r+i}(JSON.stringify(n));o.postMessage({cmd:"st",d:{p:r,h:A(c),t:v}})}())},r.ontimeout=function(){e&&!s&&(s=!0,e())},r.onerror=function(){e&&!s&&(s=!0,e())},r.open("GET",A(c)+"/api/trace/web/pre_download/v3/"+a+"?cps="+!!t+"&appKey="+c,!0),r.send(null)):(r.open("GET",A(c)+"/api/trace/web/pre_download/v3/"+a+"?cps="+!!t+"&appKey="+c,!1),r.send(null))};const r="2.5.2";let o,i="",a="",c="",s="",d="",u=void 0,l=!1,f=!1,p=window.navigator.userAgent.toLowerCase(),m=/android/i.test(p),v=/iphone|ipad|ipod/i.test(p),h=m&&/micromessenger/.test(p),w="https://report.sharetrace.com",b=void 0,g=!0,y=2500,x=void 0,E="elhref",O=!1,T=!1;function S(e){e=e||16;for(var t="012345678abcdef",n=t.length,r="",o=0;o<e;o++)r+=t.charAt(Math.floor(Math.random()*n));return r}function D(){return document.hidden||document.webkitHidden||document.msHidden}function R(e,t){let n=(new Date).getTime(),r=setTimeout(function(){null==r||D()||Date.now()-n<=t+200&&e&&e()},t);document.addEventListener(function(){let e;return void 0!==document.hidden?e="visibilitychange":void 0!==document.msHidden?e="msvisibilitychange":void 0!==document.webkitHidden&&(e="webkitvisibilitychange"),e}(),function(){D()&&(clearTimeout(r),r=null)},!1),window.addEventListener("pagehide",function(){clearTimeout(r),r=null},!1)}function _(e){window.location=e}function k(e){var t=document.createElement("a");t.style.display="none",t.href=e,document.body.appendChild(t),t.click()}function N(e,t,n,r,o){let i=-1;var a,c;(t&&(m?i=r?h?300:r.startsWith("intent")?-1:T&&O?500:y:300:v&&o||(i=300)),i>0&&R(function(){window.location.href=n},i),e)&&(v?o?r?!function(){var e=p.match(/cpu iphone os (.*?) like mac os/);if(e.length>1){var t=e[1].split("_");if(t.length>1&&(t[0]<9||t[0]<=9&&t[1]<2))return!0}return!1}()&&t?_(o):_(r):_(o):r&&_(r):r&&(!t&&r.startsWith("intent")&&(r=function(e){let t=[],n=e.split(";");for(let e=0;e<n.length;e++)n[e].includes("browser_fallback_url")||t.push(n[e]);return t.join(";")}(r)),"loc"===E?_(r):"frm"===E?(a=r,(c=document.createElement("iframe")).style.display="none",c.style.visibility="hidden",c.src=a,document.body.appendChild(c)):"elhref"===E?k(r):"open"===E?function(e){window.open(e)}(r):k(r)))}function A(e){return b||(w&&w.indexOf(".sharetrace.com")>=0?"https://clb-"+e+".sharetrace.com":w)}}]).default});